#!/usr/bin/env bash

set -e

IMAGE="ghcr.io/cainiaocome/ai-in-container:main"
HOME_DIR_ON_HOST="$HOME/.homes_for_containers/copilot"
HOME_DIR_IN_CONTAINER="/home/ubuntu"

# Fail fast if GH_TOKEN is not set
: "${GH_TOKEN:?Environment variable GH_TOKEN is not set}"

mkdir -p "$HOME_DIR_ON_HOST"

docker run --rm -it \
  -e GH_TOKEN \
  -v $HOME_DIR_ON_HOST:$HOME_DIR_IN_CONTAINER \
  -v "$(pwd):/app" \
  "$IMAGE" \
  copilot --allow-all-tools --allow-all-paths
