#!/usr/bin/env bash

IMAGE="ghcr.io/cainiaocome/ai-in-container:main"
HOME_DIR_ON_HOST="$HOME/.homes_for_containers/copilot"
HOME_DIR_IN_CONTAINER="/home/ubuntu"
CONTAINER_NAME="ai-here-copilot"

# Remove old container if exists
if [ "$(docker ps -aq -f name=^/${CONTAINER_NAME}$)" ]; then
  docker rm -f "${CONTAINER_NAME}"
fi

# Get current folder name and set subfolder path in container
SUBFOLDER_NAME="$(basename "$(pwd)")"
CONTAINER_WORKING_FOLDER="/app/${SUBFOLDER_NAME}"

docker run --rm -it \
  --name "${CONTAINER_NAME}" \
  -e GH_TOKEN \
  -v $HOME_DIR_ON_HOST:$HOME_DIR_IN_CONTAINER \
  -v "$(pwd):${CONTAINER_WORKING_FOLDER}" \
  -w "${CONTAINER_WORKING_FOLDER}" \
  "$IMAGE" \
  copilot --allow-all-tools --allow-all-paths
